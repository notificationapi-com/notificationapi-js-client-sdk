"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[42],{5042:function(e,t,n){n.r(t),n.d(t,{default:function(){return L}}),(i=s||(s={})).AUTOMATIC="AUTOMATIC",i.MANUAL="MANUAL",i.MANUAL_AND_CLICK="MANUAL_AND_CLICK",(a=r||(r={})).TopLeft="topLeft",a.TopRight="topRight",a.LeftTop="leftTop",a.LeftBottom="leftBottom",a.BottomLeft="bottomLeft",a.BottomRight="bottomRight",a.RightTop="rightTop",a.RightBottom="rightBottom",(o=c||(c={})).FCM="FCM",o.APN="APN";var i,a,o,s,r,c,d=function(e,t){if(e<0)return t.t("just_now");var n=Math.round(e)/1e3,i=Math.round(n/60),a=Math.round(n/3600),o=Math.round(n/86400),s=Math.round(n/2592e3),r=Math.round(n/946728e3);return r>0?"".concat(r," ").concat(1===r?t.t("year"):t.t("years")," ").concat(t.t("ago")):s>0?"".concat(s," ").concat(1===s?t.t("month"):t.t("months")," ").concat(t.t("ago")):o>0?"".concat(o," ").concat(1===o?t.t("day"):t.t("days")," ").concat(t.t("ago")):a>0?"".concat(a," ").concat(1===a?t.t("hour"):t.t("hours")," ").concat(t.t("ago")):i>0?"".concat(i," ").concat(1===i?t.t("minute"):t.t("minutes")," ").concat(t.t("ago")):t.t("just_now")},p=n(4991),l=JSON.parse('{"no_more_notifications":"No more notifications to load","notifications":"Notifications","notification_settings":"Notification Settings","mark_all_as_read":"Mark all as read","no_notifications":"You don\'t have any notifications!","notification_preferences":"Notification Preferences","click_here":"Click here","necessary_permissions_push_notifications":"to give us the necessary browser permissions to send you push notifications.","do_you_want_to_receive_push_notifications":"Do you want to receive push notifications?","yes":"Yes","no_thanks":"No, thanks","expand":"expand","there_are_no_notifications_to_configure":"There are no notifications to configure.","mark_as_read":"Mark as read","ago":"ago","year":"year","years":"years","month":"month","months":"months","day":"day","days":"days","hour":"hour","hours":"hours","minute":"minute","minutes":"minutes","just_now":"just now"}'),u=JSON.parse('{"no_more_notifications":"No hay m\xe1s notificaciones para cargar","notifications":"Notificaciones","notification_settings":"Configuraci\xf3n de notificaciones","mark_all_as_read":"Marcar todas como le\xeddas","no_notifications":"\xa1No tienes ninguna notificaci\xf3n!","notification_preferences":"Preferencias de notificaci\xf3n","click_here":"Haz clic aqu\xed","necessary_permissions_push_notifications":"para darnos los permisos necesarios del navegador para enviarte notificaciones push.","do_you_want_to_receive_push_notifications":"\xbfQuieres recibir notificaciones push?","yes":"S\xed","no_thanks":"No, gracias","expand":"expandir","there_are_no_notifications_to_configure":"No hay notificaciones para configurar.","mark_as_read":"Marcar como le\xedda","ago":"hace","year":"a\xf1o","years":"a\xf1os","month":"mes","months":"meses","day":"d\xeda","days":"d\xedas","hour":"hora","hours":"horas","minute":"minuto","minutes":"minutos","just_now":"justo ahora"}'),f=JSON.parse('{"no_more_notifications":"Plus de notifications \xe0 charger","notifications":"Notifications","notification_settings":"Param\xe8tres de notification","mark_all_as_read":"Marquer tout comme lu","no_notifications":"Vous n\'avez aucune notification !","notification_preferences":"Pr\xe9f\xe9rences de notification","click_here":"Cliquez ici","necessary_permissions_push_notifications":"pour nous donner les autorisations de navigateur n\xe9cessaires pour vous envoyer des notifications push.","do_you_want_to_receive_push_notifications":"Voulez-vous recevoir des notifications push ?","yes":"Oui","no_thanks":"Non, merci","expand":"d\xe9velopper","there_are_no_notifications_to_configure":"Il n\'y a pas de notifications \xe0 configurer.","mark_as_read":"Marquer comme lu","ago":"il y a","year":"an","years":"ans","month":"mois","months":"mois","day":"jour","days":"jours","hour":"heure","hours":"heures","minute":"minute","minutes":"minutes","just_now":"\xe0 l\'instant"}'),h=JSON.parse('{"no_more_notifications":"Non ci sono altre notifiche da caricare","notifications":"Notifiche","notification_settings":"Impostazioni notifiche","mark_all_as_read":"Segna tutto come letto","no_notifications":"Non hai nessuna notifica!","notification_preferences":"Preferenze notifiche","click_here":"Clicca qui","necessary_permissions_push_notifications":"per darci i permessi necessari del browser per inviarti notifiche push.","do_you_want_to_receive_push_notifications":"Vuoi ricevere notifiche push?","yes":"S\xec","no_thanks":"No, grazie","expand":"espandi","there_are_no_notifications_to_configure":"Non ci sono notifiche da configurare.","mark_as_read":"Segna come letto","ago":"fa","year":"anno","years":"anni","month":"mese","months":"mesi","day":"giorno","days":"giorni","hour":"ora","hours":"ore","minute":"minuto","minutes":"minuti","just_now":"proprio ora"}'),m=JSON.parse('{"no_more_notifications":"Geen notificaties meer om in te laden","notifications":"Notificaties","notification_settings":"Notificatie instellingen","mark_all_as_read":"Markeer alles als gelezen","no_notifications":"Je hebt geen notificaties!","notification_preferences":"Notificatie voorkeuren","click_here":"Klik hier","necessary_permissions_push_notifications":"Om ons de nodige browser rechten te geven om push notificaties te ontvangen.","do_you_want_to_receive_push_notifications":"Wil je push notificaties ontvangen?","yes":"Ja","no_thanks":"Nee, bedankt","expand":"uitklappen","there_are_no_notifications_to_configure":"Er zijn geen notificaties om in te stellen","mark_as_read":"Markeer als gelezen","ago":"geleden","year":"jaar","years":"jaren","month":"maand","months":"maanden","day":"dag","days":"dagen","hour":"uur","hours":"uren","minute":"minuut","minutes":"minuten","just_now":"zojuist"}'),v=JSON.parse('{"no_more_notifications":"N\xe3o h\xe1 mais notifica\xe7\xf5es para carregar","notifications":"Notifica\xe7\xf5es","notification_settings":"Configura\xe7\xf5es de Notifica\xe7\xf5es","mark_all_as_read":"Marcar todas como lidas","no_notifications":"Voc\xea n\xe3o tem nenhuma notifica\xe7\xe3o!","notification_preferences":"Prefer\xeancias de Notifica\xe7\xf5es","click_here":"Clique aqui","necessary_permissions_push_notifications":"para nos dar as permiss\xf5es necess\xe1rias do navegador para enviar-lhe notifica\xe7\xf5es push.","do_you_want_to_receive_push_notifications":"Voc\xea quer receber notifica\xe7\xf5es push?","yes":"Sim","no_thanks":"N\xe3o, obrigado","expand":"expandir","there_are_no_notifications_to_configure":"N\xe3o h\xe1 notifica\xe7\xf5es para configurar.","mark_as_read":"Marcar como lida","ago":"atr\xe1s","year":"ano","years":"anos","month":"m\xeas","months":"meses","day":"dia","days":"dias","hour":"hora","hours":"horas","minute":"minuto","minutes":"minutos","just_now":"agora mesmo"}'),g=function(e,t,n,i){return new(n||(n=Promise))(function(a,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function r(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(s,r)}c((i=i.apply(e,t||[])).next())})},_=function(e,t){var n,i,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function r(o){return function(r){return function(o){if(n)throw TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(a=2&o[0]?i.return:o[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,o[1])).done)return a;switch(i=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,r])}}},b=["en-US","es-ES","fr-FR","it-IT","nl-NL","pt-BR"],y={"en-US":l,"es-ES":u,"fr-FR":f,"it-IT":h,"nl-NL":m,"pt-BR":v},L=function(){function e(e){var t,n,i=this;this.destroy=function(){var e;null===(e=i.websocket)||void 0===e||e.close(),Object.values(i.elements).map(function(e){e&&e.remove()})},this.identify=function(e){return g(i,void 0,void 0,function(){var t,n,i,a,o,s;return _(this,function(r){switch(r.label){case 0:if(n=(t=this.state.initOptions).clientId,i=t.userId,a=t.userIdHash,e.id&&e.id!==i)return console.error('The userId "'.concat(e.id,'" does not match the userId "').concat(i,'" provided in the init options. Cancelling action to prevent mistakes.')),[2];return o="".concat(this.state.restBaseURL,"/").concat(encodeURIComponent(n),"/users/").concat(encodeURIComponent(i)),s="Basic "+btoa("".concat(n,":").concat(i,":").concat(null!=a?a:"")),[4,fetch(o,{body:JSON.stringify(e),headers:{"content-type":"application/json",Authorization:s},method:"POST"})];case 1:return r.sent(),[2]}})})},this.askForWebPushPermission=function(){var e;"serviceWorker"in navigator&&navigator.serviceWorker.register(null!==(e=i.state.initOptions.customServiceWorkerPath)&&void 0!==e?e:"/notificationapi-service-worker.js").then(function(e){return g(i,void 0,void 0,function(){var t=this;return _(this,function(n){return Notification.requestPermission().then(function(n){return g(t,void 0,void 0,function(){var t=this;return _(this,function(i){switch(i.label){case 0:if("granted"!==n)return[3,2];return[4,e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.state.webPushSettings.applicationServerKey}).then(function(e){return g(t,void 0,void 0,function(){var t;return _(this,function(n){switch(n.label){case 0:return t={webPushTokens:[{sub:{endpoint:e.toJSON().endpoint,keys:e.toJSON().keys}}]},[4,this.identify(t)];case 1:return n.sent(),[2]}})})})];case 1:i.sent(),i.label=2;case 2:return[2]}})})}),[2]})})})},this.showInApp=function(e){i.state.inappOptions=e;var t,n=document.getElementById(e.root);if(!n){console.error('There are no HTML elements with id="'.concat(e.root,'" on the page.'));return}if(i.elements.root=n,e.popupPosition&&!Object.values(r).includes(e.popupPosition)){console.error('"'.concat(e.popupPosition,'" is not a valid position. Valid positions: ').concat(Object.values(r).join(", ")));return}n.hasChildNodes()&&(n.innerHTML="");var a=document.createElement("div");a.classList.add("notificationapi-container"),n.appendChild(a),i.elements.popup=document.createElement("div");var o=i.elements.popup;if(o.classList.add("notificationapi-popup"),e.inline)o.classList.add("inline");else{o.classList.add("popup"),o.classList.add("hovering"),o.classList.add("closed");var c=document.createElement("button");c.classList.add("notificationapi-button"),c.innerHTML='<span class="icon-bell-o"></span>',a.appendChild(c),c.onclick=function(){o.classList.contains("closed")?i.openInAppPopup():i.closeInAppPopup()},i.elements.button=c,window.addEventListener("click",function(e){var t,n,a,s=null!==(t=e.target.closest(".notificationapi-popup"))&&void 0!==t&&t,r=null!==(n=e.target.closest(".notificationapi-button"))&&void 0!==n&&n,c=null!==(a=e.target.closest(".notificationapi-preferences-container"))&&void 0!==a&&a;r||s||c||i.elements.notificationMenu||o.classList.add("closed")});var d=document.createElement("div");d.classList.add("notificationapi-unread"),c.appendChild(d),i.elements.unread=d,i.setInAppUnread(i.state.unread)}a.appendChild(o),window.addEventListener("click",function(e){var t;!(null!==(t=e.target.closest(".notificationapi-notification-menu-button"))&&void 0!==t&&t)&&i.elements.notificationMenu&&(i.elements.notificationMenu.remove(),i.elements.notificationMenu=void 0)}),i.elements.popupInner=document.createElement("div");var l=i.elements.popupInner;l.classList.add("notificationapi-popup-inner"),o.appendChild(l),i.elements.popupInner=l,i.elements.header=document.createElement("div");var u=document.createElement("button");u.classList.add("notificationapi-close-button"),u.addEventListener("click",function(){i.closeInAppPopup()}),i.elements.header.appendChild(u);var f=document.createElement("h1");f.innerHTML=p.ZP.t("notifications"),i.elements.header.appendChild(f);var h=document.createElement("button");if(h.classList.add("notificationapi-preferences-button"),h.innerHTML='<span class="icon-cog"></span>',h.title=p.ZP.t("notification_settings"),h.addEventListener("click",function(){i.showUserPreferences()}),i.elements.header.appendChild(h),e.markAsReadMode&&e.markAsReadMode!==s.AUTOMATIC){var m=document.createElement("button");m.classList.add("notificationapi-readAll-button"),m.innerHTML='<span class="icon-check"></span>',m.title=p.ZP.t("mark_all_as_read"),m.addEventListener("click",function(){i.readAll()}),i.elements.header.appendChild(m)}i.elements.header.classList.add("notificationapi-header"),l.appendChild(i.elements.header);var v=document.createElement("div");v.classList.add("notificationapi-loading");var g=document.createElement("span");if(g.classList.add("icon-spinner8","spinner"),v.appendChild(g),l.appendChild(v),i.elements.notificationsLoading=v,i.elements.footer=document.createElement("div"),e.paginated){i.state.pageSize=null!==(t=e.pageSize)&&void 0!==t?t:5;var _=document.createElement("button");_.classList.add("notificationapi-prev-button"),_.innerHTML="<",_.disabled=!0,_.addEventListener("click",function(){i.changePage(i.state.currentPage-1)}),i.elements.prevButton=_;var b=document.createElement("button");b.classList.add("notificationapi-next-button"),b.innerHTML=">",b.disabled=!0,b.addEventListener("click",function(){i.changePage(i.state.currentPage+1)}),i.elements.nextButton=b,i.elements.footer.appendChild(_),i.elements.footer.appendChild(b)}i.elements.footer.classList.add("notificationapi-footer"),l.appendChild(i.elements.footer),i.addNotificationsToState(i.state.notifications),e.paginated||(l.onscroll=function(){l.scrollTop+l.clientHeight>=l.scrollHeight-100&&i.requestMoreNotifications()}),i.sendWSMessage({route:"inapp_web/unread_count"}),i.sendWSMessage({route:"inapp_web/notifications",payload:{count:50}}),i.websocket&&i.websocket.addEventListener("message",function(e){var t=JSON.parse(e.data);if(t&&t.route){if("inapp_web/unread_count"===t.route){var n=t;i.websocketHandlers.unreadCount(n)}if("inapp_web/notifications"===t.route){var n=t;i.websocketHandlers.notifications(n)}if("inapp_web/new_notifications"===t.route){var n=t;i.websocketHandlers.newNotifications(n)}}})},this.elements={},this.state={initOptions:e,lastNotificationsRequestAt:0,notifications:[],unread:0,oldestNotificationsDate:"",currentPage:0,pageSize:999999,webPushSettings:{applicationServerKey:"",askForWebPushPermission:!1},restBaseURL:null!==(t=e.restBaseURL)&&void 0!==t?t:"https://api.notificationapi.com"};var a=b.reduce(function(e,t){return e[t]={translation:y[t]},e},{});if(p.ZP.init({resources:a,lng:this.state.initOptions.language,fallbackLng:"en-US"}),this.websocketHandlers={notifications:function(e){var t=e.payload.notifications;if(i.state.lastResponseNotificationsCount=t.length,i.elements.notificationsLoading&&(i.elements.notificationsLoading.remove(),delete i.elements.notificationsLoading),i.addNotificationsToState(t),t.length<50&&!i.elements.empty&&i.elements.popupInner&&i.state.inappOptions&&!i.state.inappOptions.paginated){var n=document.createElement("div");n.innerHTML=p.ZP.t("no_more_notifications"),n.classList.add("notificationapi-nomore"),i.elements.popupInner.append(n)}i.renderNotifications()},newNotifications:function(e){var t=i.state.notifications.length;i.elements.notificationsLoading&&(i.elements.notificationsLoading.remove(),delete i.elements.notificationsLoading),i.addNotificationsToState(e.payload.notifications),i.renderNotifications();var n=i.state.notifications.length;i.setInAppUnread(i.state.unread+n-t)},unreadCount:function(e){i.setInAppUnread(e.payload.count)},userPreferences:function(e){i.elements.preferencesLoading&&(i.elements.preferencesLoading.remove(),delete i.elements.preferencesLoading),i.renderPreferences(e.payload.userPreferences)}},!e.clientId||"undefined"===e.clientId){console.error("Invalid clientId.");return}if(!e.userId||"undefined"===e.userId){console.error("Invalid userId.");return}if(!1!==e.websocket){var o="".concat(null!==(n=e.websocket)&&void 0!==n?n:"wss://ws.notificationapi.com","?envId=").concat(encodeURIComponent(e.clientId),"&userId=").concat(encodeURIComponent(e.userId)).concat(e.userIdHash?"&userIdHash="+encodeURIComponent(e.userIdHash):"");this.websocket=new WebSocket(o),this.websocket.addEventListener("message",function(e){var t=JSON.parse(e.data);t&&t.route&&"environment/data"===t.route&&(i.state.webPushSettings.applicationServerKey=t.payload.applicationServerKey,"Notification"in window&&"granted"===Notification.permission?i.state.webPushSettings.askForWebPushPermission=!1:(i.state.webPushSettings.askForWebPushPermission=t.payload.askForWebPushPermission,i.state.webPushSettings.askForWebPushPermission&&i.renderWebPushOptIn()))}),this.sendWSMessage({route:"environment/data"})}}return e.prototype.requestMoreNotifications=function(){if(this.websocket&&new Date().getTime()-this.state.lastNotificationsRequestAt>=500&&(void 0===this.state.lastResponseNotificationsCount||this.state.lastResponseNotificationsCount>=50)){this.state.lastNotificationsRequestAt=new Date().getTime();var e={route:"inapp_web/notifications",payload:{before:this.state.oldestNotificationsDate,count:50}};this.sendWSMessage(e)}},e.prototype.showUserPreferences=function(e){var t=this;if(this.elements.preferencesContainer)this.elements.preferencesContainer.classList.remove("closed");else{var n=document.getElementsByTagName("body")[0];if(null==e?void 0:e.parent){var i=document.getElementById(e.parent);i?n=i:console.error('There are no HTML elements with id="'.concat(e.parent,'" on the page.'))}var a=document.createElement("div");a.classList.add("notificationapi-preferences-container"),(null==e?void 0:e.parent)&&a.classList.add("inline"),this.elements.preferencesContainer=a,n.appendChild(a);var o=document.createElement("div");o.classList.add("notificationapi-preferences-backdrop"),o.addEventListener("click",function(){a.classList.add("closed")}),a.appendChild(o);var s=document.createElement("div");s.classList.add("notificationapi-preferences-popup"),a.appendChild(s),this.elements.preferencesPopup=s;var r=document.createElement("button");r.classList.add("notificationapi-preferences-close"),r.addEventListener("click",function(){a.classList.add("closed")}),s.appendChild(r);var c=document.createElement("h1");if(c.innerHTML=p.ZP.t("notification_preferences"),s.appendChild(c),this.state.webPushSettings.askForWebPushPermission){var d=document.createElement("p");d.innerHTML='<a href="#" class="click-here">'.concat(p.ZP.t("click_here"),"</a> ").concat(p.ZP.t("necessary_permissions_push_notifications")),d.classList.add("notificationapi-preferences-web-push-opt-in"),s.appendChild(d),d.addEventListener("click",function(e){e.preventDefault(),t.askForWebPushPermission()})}var l=document.createElement("div");l.classList.add("notificationapi-loading");var u=document.createElement("span");u.classList.add("icon-spinner8","spinner"),l.appendChild(u),s.appendChild(l),this.elements.preferencesLoading=l,this.websocket&&this.websocket.addEventListener("message",function(e){var n=JSON.parse(e.data);n&&n.route&&"user_preferences/preferences"===n.route&&t.websocketHandlers.userPreferences(n)})}this.sendWSMessage({route:"user_preferences/get_preferences"})},e.prototype.getUserPreferences=function(){return g(this,void 0,void 0,function(){return _(this,function(e){switch(e.label){case 0:return this.sendWSMessage({route:"user_preferences/get_preferences"}),[4,this.websocketMessageReceived("user_preferences/preferences")];case 1:return[2,e.sent().payload.userPreferences]}})})},e.prototype.patchUserPreference=function(e,t,n,i){var a={route:"user_preferences/patch_preferences",payload:[{notificationId:e,channelPreferences:[{channel:t,state:n}]}]};i&&(a.payload[0].subNotificationId=i),this.sendWSMessage(a)},e.prototype.openInAppPopup=function(){var e,t,n,i,a,o,c,d,p,l;this.elements.popup&&this.elements.popupInner&&this.elements.button&&this.state.inappOptions&&!this.state.inappOptions.inline&&(t=this.elements.popup,n=this.elements.popupInner,i=this.elements.button,a=(null!==(e=this.state.inappOptions.popupPosition)&&void 0!==e?e:r.RightBottom).toString(),o=document.documentElement.clientHeight+"px",c="auto",d="auto",p="auto",l="auto",window.innerWidth<768?(c=-i.getBoundingClientRect().top+"px",d=-(document.documentElement.clientHeight-i.getBoundingClientRect().bottom)+"px",p=-i.getBoundingClientRect().left+"px",l=-(document.documentElement.clientWidth-i.getBoundingClientRect().right)+"px"):(a.startsWith("top")&&(d=i.clientHeight+10+"px",o=i.getBoundingClientRect().top-20+"px"),a.startsWith("bottom")&&(d="auto",c=i.clientHeight+10+"px",o=window.innerHeight-i.getBoundingClientRect().bottom-40+"px"),a.startsWith("left")&&(p="auto",l=i.clientWidth+10+"px"),a.startsWith("right")&&(l="auto",p=i.clientWidth+10+"px"),a.endsWith("Top")&&(c="auto",d="0px",o=i.getBoundingClientRect().bottom-20+"px"),a.endsWith("Bottom")&&(d="auto",c="0px",o=window.innerHeight-i.getBoundingClientRect().top-40+"px"),a.endsWith("Left")&&(p="auto",l="0px"),a.endsWith("Right")&&(l="auto",p="0px")),t.style.top=c,t.style.bottom=d,t.style.left=p,t.style.right=l,n.style.maxHeight=o,this.elements.popup.classList.remove("closed"),this.state.inappOptions.markAsReadMode&&this.state.inappOptions.markAsReadMode!==s.AUTOMATIC||this.readAll())},e.prototype.readAll=function(){this.setInAppUnread(0),this.state.notifications.map(function(e){e.seen=!0}),this.sendWSMessage({route:"inapp_web/unread_clear"}),this.state.inappOptions&&this.state.inappOptions.markAsReadMode&&this.state.inappOptions.markAsReadMode!==s.AUTOMATIC&&this.elements.popupInner&&this.elements.popupInner.querySelectorAll(".unseen").forEach(function(e){e.classList.remove("unseen")})},e.prototype.closeInAppPopup=function(){this.elements.popup&&this.state.inappOptions&&!this.state.inappOptions.inline&&this.elements.popup.classList.add("closed")},e.prototype.setInAppUnread=function(e){this.state.unread=e,this.elements.unread&&this.state.inappOptions&&!this.state.inappOptions.inline&&(0===e?this.elements.unread.classList.add("hidden"):this.elements.unread.classList.remove("hidden"),e<100?this.elements.unread.innerHTML=e+"":this.elements.unread.innerHTML="+99")},e.prototype.addNotificationsToState=function(e){var t=this,n=e.filter(function(e){return!t.state.notifications.find(function(t){return t.id===e.id})});if(this.state.notifications=this.state.notifications.concat(n),this.state.notifications.sort(function(e,t){return Date.parse(t.date)-Date.parse(e.date)}),this.state.notifications.length>0&&(this.state.oldestNotificationsDate=this.state.notifications[this.state.notifications.length-1].date),0===this.state.notifications.length&&!this.elements.empty&&!this.elements.notificationsLoading&&this.elements.header){var i=document.createElement("div");i.classList.add("notificationapi-empty"),i.innerHTML=p.ZP.t("no_notifications"),this.elements.header.after(i),this.elements.empty=i}n.length>0&&this.elements.empty&&(this.elements.empty.remove(),delete this.elements.empty)},e.prototype.getPageCount=function(){return Math.max(1,Math.ceil(this.state.notifications.length/this.state.pageSize))},e.prototype.changePage=function(e){this.state.currentPage=e,this.state.currentPage>=this.getPageCount()-2&&this.requestMoreNotifications(),this.renderNotifications()},e.prototype.renderNotifications=function(){var e=this.elements.header,t=this.elements.popupInner;if(e&&t&&this.state.inappOptions){var n=this.state.currentPage,i=this.state.pageSize;this.state.inappOptions.paginated&&t.querySelectorAll(".notificationapi-notification").forEach(function(e){e.remove()});for(var a=n*i;a<this.state.notifications.length&&a<n*i+i;a++){var o=this.state.notifications[a];if(!t.querySelector('[data-notification-id="'.concat(o.id,'"]'))){var s=this.generateNotificationElement(o);if(a===n*i)e.insertAdjacentElement("afterend",s);else{var r=t.querySelector('[data-notification-id="'.concat(this.state.notifications[a-1].id,'"]'));r?r.insertAdjacentElement("afterend",s):console.error("error finding previous notification",this.state.notifications[a-1])}}}this.elements.prevButton&&(this.elements.prevButton.disabled=0===n),this.elements.nextButton&&(this.elements.nextButton.disabled=n>=this.state.notifications.length/i-1)}},e.prototype.generateNotificationElement=function(e){var t=this,n=document.createElement("a");n.setAttribute("data-notification-id",e.id),n.classList.add("notificationapi-notification"),e.redirectURL&&(n.href=e.redirectURL);var i=document.createElement("div");if(i.classList.add("notificationapi-notification-imageContainer"),e.imageURL){var a=document.createElement("img");a.classList.add("notificationapi-notification-image"),a.src=e.imageURL,i.appendChild(a)}else{var o=document.createElement("span");o.classList.add("icon-commenting-o"),o.classList.add("notificationapi-notification-defaultIcon"),i.appendChild(o)}n.appendChild(i);var r=document.createElement("div");r.classList.add("notificationapi-notification-metaContainer");var c=document.createElement("p");c.classList.add("notificationapi-notification-title"),c.innerHTML=e.title,r.appendChild(c);var l=document.createElement("p");if(l.classList.add("notificationapi-notification-date"),l.innerHTML=d(Date.now()-new Date(e.date).getTime(),p.ZP),r.appendChild(l),n.appendChild(r),e.seen||n.classList.add("unseen"),this.state.inappOptions&&this.state.inappOptions.markAsReadMode&&this.state.inappOptions.markAsReadMode!==s.AUTOMATIC){var u=document.createElement("button");u.classList.add("notificationapi-notification-menu-button"),u.innerHTML='<span class="icon-ellipsis-h"></span>',u.addEventListener("click",function(i){i.preventDefault(),null===(a=t.elements.notificationMenu)||void 0===a||a.remove();var a,o=document.createElement("div");o.classList.add("notificationapi-notification-menu");var s=document.createElement("button");s.classList.add("notificationapi-notification-menu-item"),s.innerHTML='<span class="icon-check"></span><span class="notificationapi-notification-menu-item-text">'.concat(p.ZP.t("mark_as_read"),"</span>"),s.addEventListener("click",function(i){i.preventDefault(),n.classList.remove("unseen"),t.setInAppUnread(t.state.unread-1),t.sendWSMessage({route:"inapp_web/unread_clear",payload:{notificationId:e.id}})}),o.appendChild(s),n.appendChild(o),t.elements.notificationMenu=o}),n.appendChild(u)}return this.state.inappOptions&&this.state.inappOptions.markAsReadMode===s.MANUAL_AND_CLICK&&n.addEventListener("click",function(i){var a=i.target;a.classList.contains("notificationapi-notification-menu-button")||a.classList.contains("notificationapi-notification-menu")||a.closest(".notificationapi-notification-menu-button")||a.closest(".notificationapi-notification-menu")||e.seen||(n.classList.remove("unseen"),e.seen=!0,t.setInAppUnread(t.state.unread-1),t.sendWSMessage({route:"inapp_web/unread_clear",payload:{notificationId:e.id}}))}),n},e.prototype.renderPreferences=function(e){var t,n=this;if(this.elements.preferencesPopup){var i=this.elements.preferencesPopup,a=e.filter(function(e){return e.settings.length>0});if(0===a.length&&!this.elements.preferencesEmpty){var o=document.createElement("div");o.classList.add("notificationapi-preferences-empty"),o.innerHTML=p.ZP.t("there_are_no_notifications_to_configure"),i.appendChild(o),this.elements.preferencesEmpty=o;return}null===(t=this.elements.preferencesGrid)||void 0===t||t.remove(),this.elements.preferencesGrid=void 0;var s=document.createElement("div");s.classList.add("notificationapi-preferences-grid"),this.elements.preferencesGrid=s,i.appendChild(s);var r={};a.map(function(e){e.settings.map(function(e){r[e.channel]||(r[e.channel]=e.channelName)})});var c=1;Object.values(r).map(function(e,t){var n=document.createElement("div");n.innerHTML=e,n.classList.add("notificationapi-preferences-channel","notificationapi-preferences-col".concat(t+2),"notificationapi-preferences-row".concat(c)),s.appendChild(n)}),c++,a.map(function(e){var t=document.createElement("div");if(t.classList.add("notificationapi-preferences-title","notificationapi-preferences-col1","notificationapi-preferences-row".concat(c)),t.innerHTML=e.title,s.appendChild(t),e.settings.map(function(t){var i=document.createElement("div"),a=Object.keys(r).indexOf(t.channel)+2;i.classList.add("notificationapi-preferences-toggle","notificationapi-preferences-col".concat(a),"notificationapi-preferences-row".concat(c)),i.setAttribute("data-notificationId",e.notificationId),i.setAttribute("data-channel",t.channel);var o=document.createElement("label");o.classList.add("switch"),i.appendChild(o);var d=document.createElement("input");d.setAttribute("type","checkbox"),d.checked=t.state,o.appendChild(d);var p=document.createElement("i");o.appendChild(p),d.addEventListener("change",function(){s.querySelectorAll('.notificationapi-preferences-subtoggle[data-notificationid="'.concat(e.notificationId,'"][data-channel="').concat(t.channel,'"] input')).forEach(function(e){e.disabled=!d.checked}),n.patchUserPreference(e.notificationId,t.channel,d.checked)}),s.appendChild(i)}),c++,e.subNotificationPreferences&&e.subNotificationPreferences.length>0){var a=document.createElement("button");a.innerHTML=p.ZP.t("expand"),a.setAttribute("data-notificationId",e.notificationId);var o=Object.keys(r).length+2;a.classList.add("notificationapi-preferences-expand","notificationapi-preferences-col".concat(o),"notificationapi-preferences-row".concat(c-1)),a.addEventListener("click",function(e){var t=e.target.getAttribute("data-notificationId");i.querySelectorAll('[data-notificationId="'.concat(t,'"][data-subNotificationId]')).forEach(function(e){e.classList.toggle("closed")})}),s.appendChild(a),e.subNotificationPreferences.map(function(t){var i=document.createElement("div");i.classList.add("notificationapi-preferences-subtitle","notificationapi-preferences-col1","notificationapi-preferences-row".concat(c),"closed"),i.setAttribute("data-subNotificationId",t.subNotificationId),i.setAttribute("data-notificationId",e.notificationId),i.innerHTML=t.title,s.appendChild(i),t.settings.map(function(i){var a=document.createElement("div"),o=Object.keys(r).indexOf(i.channel)+2;a.classList.add("notificationapi-preferences-subtoggle","notificationapi-preferences-col".concat(o),"notificationapi-preferences-row".concat(c),"closed"),a.setAttribute("data-notificationId",t.notificationId),a.setAttribute("data-subNotificationId",t.subNotificationId),a.setAttribute("data-channel",i.channel);var d=document.createElement("label");d.classList.add("switch","small"),a.appendChild(d);var p=document.createElement("input");p.setAttribute("type","checkbox"),p.checked=i.state,e.settings.find(function(e){return e.channel===i.channel&&!1===e.state})&&(p.disabled=!0),d.appendChild(p);var l=document.createElement("i");d.appendChild(l),p.addEventListener("change",function(){n.patchUserPreference(e.notificationId,i.channel,p.checked,t.subNotificationId)}),s.appendChild(a)}),c++})}})}},e.prototype.renderWebPushOptIn=function(){var e=this,t=JSON.parse(localStorage.getItem("askForWebPushPermission")||"true");if(this.elements.header&&t){var n=document.createElement("div");n.classList.add("notificationapi-opt-in-container");var i=document.createElement("div");i.innerHTML=p.ZP.t("do_you_want_to_receive_push_notifications"),i.classList.add("notificationapi-opt-in-message"),n.appendChild(i);var a=document.createElement("button");a.innerHTML=p.ZP.t("yes"),a.classList.add("notificationapi-allow-button"),a.addEventListener("click",function(){e.askForWebPushPermission(),localStorage.setItem("askForWebPushPermission","false"),n.style.display="none"}),n.appendChild(a);var o=document.createElement("button");o.innerHTML=p.ZP.t("no_thanks"),o.classList.add("notificationapi-no-thanks-button"),o.addEventListener("click",function(){localStorage.setItem("askForWebPushPermission","false"),n.style.display="none"}),n.appendChild(o),this.elements.header.appendChild(n)}},e.prototype.sendWSMessage=function(e){if(this.websocket){var t=this.websocket;t.readyState==t.OPEN?t.send(JSON.stringify(e)):t.addEventListener("open",function(){t.send(JSON.stringify(e))})}},e.prototype.websocketMessageReceived=function(e){return g(this,void 0,void 0,function(){var t;return _(this,function(n){switch(n.label){case 0:return[4,this.websocketOpened()];case 1:return t=n.sent(),[2,new Promise(function(n){t.addEventListener("message",function(t){var i=JSON.parse(t.data);i&&i.route&&i.route===e&&n(i)})})]}})})},e.prototype.websocketOpened=function(){var e=this;return new Promise(function(t,n){var i=e.websocket;if(!i){n("Websocket is not present.");return}var a=function(){i.readyState===i.OPEN?t(i):i.readyState===i.CLOSED||i.readyState===i.CLOSING?n("Websocket failed to open."):setTimeout(a,100)};a()})},e}()}}]);